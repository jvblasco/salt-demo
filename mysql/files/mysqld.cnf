##################################
# **** DO NOT EDIT THIS FILE ****
# This file is managed by Salt
# Any changes will be overwritten
##################################

[mysqld]
datadir                                 = /var/lib/percona-server
innodb_data_home_dir                    = /var/lib/percona-server
innodb_log_group_home_dir               = /var/lib/percona-server
slow_query_log_file                     = /var/log/mysql/slow-queries.log
log_error                               = /var/log/mysql/error.log
basedir                                 = /usr
tmpdir                                  = /tmp
lc-messages-dir                         = /usr/share/mysql

user                                    = mysql
socket                                  = /var/run/mysqld/mysqld.sock
pid-file                                = /var/run/mysqld/mysqld.pid
bind_address                            = {{ settings['bind_address'] }}
port                                    = 3306
report_host                             = {{ settings['hostname'] }}
max_connections                         = {{ settings['max_connections'] }}

slow_query_log                          = 1
tmp_table_size                          = 32M
character_set_server                    = utf8
collation_server                        = utf8_general_ci
myisam-recover-options                  = BACKUP

default_storage_engine                  = InnoDB
innodb_additional_mem_pool_size         = 20M
innodb_autoinc_lock_mode                = 2
innodb_buffer_pool_size                 = {{ settings['innodb_buffer'] }}
innodb_data_file_path                   = ibdata1:10M:autoextend
innodb_file_per_table
innodb_flush_log_at_trx_commit          = 1
innodb_lock_wait_timeout                = {{ settings['innodb_lock_timeout'] }}
innodb_locks_unsafe_for_binlog          = 1
innodb_log_buffer_size                  = 16M
innodb_log_file_size                    = 64M

wait_timeout                            = {{ settings['wait_timeout'] }}

query_cache_size                        = 0
query_cache_type                        = 0

join_buffer_size                        = 16M
key_buffer_size                         = 32M
myisam_sort_buffer_size                 = 64M
read_buffer_size                        = 1M
read_rnd_buffer_size                    = 4M
sort_buffer_size                        = 1M

{%- if settings['replication'] %}
server_id                               = 1
replicate_same_server_id                = 0
auto_increment_increment                = 1
auto_increment_offset                   = 1
binlog_checksum                         = CRC32
binlog_format                           = row
log_bin                                 = mysql-bin
log_bin_trust_function_creators         = 1
log_slave_updates                       = true
max_binlog_files                        = 5
sync_master_info                        = 1
{%- endif %}

group_concat_max_len                    = 4096
local_infile                            = 0
long_query_time                         = 1
master_verify_checksum                  = 1
max_allowed_packet                      = {{ settings['max_allowed_packet'] }}
max_connect_errors                      = 1000000
max_heap_table_size                     = 32M
open_files_limit                        = 65535
skip_external_locking
skip_name_resolve
symbolic_links                          = 0
table_definition_cache                  = 1024
table_open_cache                        = 256
thread_cache_size                       = 50
thread_concurrency                      = 8
